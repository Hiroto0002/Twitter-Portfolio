<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイムライン</title>
    <style>
        body { font-family: sans-serif; background-color: #e8eaf6; padding: 20px; }
        .post-list { max-width: 600px; margin: 0 auto; }
        .post-card { background: white; border: 1px solid #c5cae9; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .post-username { font-weight: bold; color: #3f51b5; }
        .post-date { font-size: 0.8em; color: #757575; }
        .post-content { margin-bottom: 10px; line-height: 1.6; }
        .post-footer { font-size: 0.9em; color: #9e9e9e; }
    </style>
</head>
<body>
    <h1>タイムライン</h1>
    <div class="post-list" id="postList">
        <p>投稿を読み込み中...</p>
    </div>

    <script>
        async function fetchPosts() {
            const postListDiv = document.getElementById('postList');
            postListDiv.innerHTML = '<p>投稿を読み込み中...</p>'; // ローディングメッセージ

            try {
                // 投稿取得APIにアクセス
                const response = await fetch('/api/posts'); 
                const posts = await response.json(); // JSON形式でデータを受け取る

                if (response.ok) {
                    postListDiv.innerHTML = ''; // ローディングメッセージを消す
                    
                    if (posts.length === 0) {
                        postListDiv.innerHTML = '<p>まだ投稿がありません。</p>';
                        return;
                    }

                    // 投稿を一件ずつ処理し、HTML要素を生成
                    posts.forEach(post => {
                        const postCard = document.createElement('div');
                        postCard.className = 'post-card';

                        // 日付の整形（例: "2025-10-01"）
                        const date = new Date(post.createdAt).toLocaleDateString();

                        postCard.innerHTML = `
                            <div class="post-header">
                                <span class="post-username">@${post.author.username}</span>
                                <span class="post-date">${date}</span>
                            </div>
                            <p class="post-content">${post.content}</p>
                            <div class="post-footer">
                                いいね: ${post.likes}
                            </div>
                        `;
                        postListDiv.appendChild(postCard);
                    });

                } else {
                    postListDiv.innerHTML = `<p style="color: red;">投稿の取得に失敗しました: ${posts.msg || 'サーバーエラー'}</p>`;
                }

            } catch (error) {
                console.error('通信エラー:', error);
                postListDiv.innerHTML = '<p style="color: red;">エラー: サーバーに接続できませんでした。</p>';
            }
        }

        // ページが読み込まれたら投稿を取得
        fetchPosts();
    </script>
</body>
</html>